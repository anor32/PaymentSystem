


<div style="width: 500px"><h3>Заказ №{{order.pk}}</h3>

<div style="width: 300px;height: 200px;border: 1px solid black">
    <ul>
{%for object in items%}
   <li style=> {{object.item.name}}
    {{object.quantity}}</li>

{%endfor%}
    </ul>
</div>
<p>{{order.total_price}}</p>
    <button type="submit" class="btn btn-default" id="buy-button">Buy</button>
</div>


<button type="button" id="delete-button">Очистить корзину</button>


<script src="https://js.stripe.com/v3/"></script>

<script type="text/javascript">
      var stripe = Stripe('{{ stripe_public_key }}');
      var buyButton = document.getElementById('buy-button');
      buyButton.addEventListener('click', function() {

         fetch("http://127.0.0.1:8000/items/buy/{{order.pk}}", {method: 'GET'})
        .then(response =>  response.json())
        .then(session => stripe.redirectToCheckout({ sessionId: session.session.id }))

      });
      var deleteButton = document.getElementById('delete-button')
      deleteButton.addEventListener('click',function () {
          fetch("http://127.0.0.1:8000/items/cart/",
              {method:'DELETE', headers: {
                'X-CSRFToken': '{{ csrf_token }}'}})
              .then(response => {
                  if (response.ok) {
                      window.location = '/items'
                  }
              })


      })
    </script>
