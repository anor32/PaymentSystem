<div style="width: 500px" xmlns="http://www.w3.org/1999/html"><h3>Заказ №{{order.pk}}</h3>

<div style="width: 300px;height: 200px;border: 1px solid black">
    <ul>
{%for object in items%}
   <li style=> {{object.item.name}}
    {{object.quantity}}</li>

{%endfor%}
    </ul>
</div>
<p>{{order.total_price}}</p>
    <button type="submit" class="btn btn-default" id="buy-button">Оплатить</button>
</div>

<form method="post" action="{% url 'items:change_currency' %}">
    {% csrf_token %}
    <label for="currency">Выберите валюту:</label>
    <select name="currency" id="currency">
        <option value="USD">USD</option>
        <option value="EUR">EUR</option>

    </select>
    <button type="submit">Изменить валюту</button>
</form>

<p> Текущая валюта для оплаты {{items.first.currency}}</p>

<button type="button" id="delete-button">Очистить корзину</button>


<script src="https://js.stripe.com/v3/"></script>

<script type="text/javascript">
      var stripe = Stripe('{{ stripe_public_key }}');
      var buyButton = document.getElementById('buy-button');
      buyButton.addEventListener('click', function() {

         fetch("http://127.0.0.1:8000/items/buy/{{order.pk}}", {method: 'GET'})
        .then(response =>  response.json())
        .then(session => stripe.redirectToCheckout({ sessionId: session.session.id }))

      });
      var deleteButton = document.getElementById('delete-button')
      deleteButton.addEventListener('click',function () {
          fetch("http://127.0.0.1:8000/items/cart/",
              {method:'DELETE', headers: {
                'X-CSRFToken': '{{ csrf_token }}'}})
              .then(response => {
                  if (response.ok) {
                      window.location = '/items'
                  }
              })


      })
    </script>
